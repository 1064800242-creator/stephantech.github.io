<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°æ™ºå†™ä½œç»ƒä¹ å®¤ - ç´§å‡‘è§†å›¾ç‰ˆ</title>
<style>
    :root {
        --primary-color: #4a90e2;
        --bg-color: #f5f7fa;
        --card-bg: #ffffff;
        --text-color: #333;
        --danger-color: #e74c3c;
        --overtime-color: #c0392b;
        --success-color: #2ecc71;
    }

    body {
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    .container {
        width: 100%;
        max-width: 1000px; 
        background: var(--card-bg);
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    /* é¡¶éƒ¨æ§åˆ¶åŒº */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #eee;
    }

    .timer-controls {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    input[type="number"] {
        width: 60px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
    }

    button {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.2s;
        color: white;
    }

    .btn-start { background-color: var(--primary-color); }
    .btn-start:hover { background-color: #357abd; }

    .btn-reset { background-color: var(--danger-color); }
    .btn-reset:hover { background-color: #c0392b; }

    .btn-submit {
        background-color: var(--success-color);
        font-size: 16px;
        padding: 10px 24px;
        margin-top: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .btn-submit:hover { background-color: #27ae60; }

    .timer-display {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--primary-color);
        font-variant-numeric: tabular-nums;
        min-width: 180px;
        text-align: right;
    }

    .timer-warning { color: var(--danger-color); animation: pulse 1s infinite; }
    .timer-overtime { color: var(--overtime-color); text-shadow: 0 0 2px rgba(192, 57, 43, 0.2); }

    /* é¢˜ç›®åŒºåŸŸ */
    .section-title {
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 10px;
        color: #555;
        display: flex;
        justify-content: space-between;
    }

    .question-area {
        margin-bottom: 25px;
        border: 2px dashed #ddd;
        padding: 15px;
        border-radius: 8px;
        background: #fafafa;
        position: relative;
        transition: border-color 0.3s;
        
        display: flex;          
        flex-direction: column; 
        
        min-height: 100px;      
        /* === ä¿®æ”¹å¤„ï¼šæœ€å¤§é«˜åº¦è°ƒæ•´ä¸º 50vh === */
        max-height: 50vh;       
        /* ================================= */
        overflow-y: auto;       
    }
    
    .question-area:focus-within {
        border-color: var(--primary-color);
    }

    .question-input {
        width: 100%;
        flex: 0 1 auto;        
        min-height: 40px;      
        border: none;
        background: transparent;
        resize: vertical;       
        font-size: 16px;
        outline: none;
        font-family: inherit;
        line-height: 1.5;
        overflow: hidden;       
        margin-bottom: 10px;    
    }

    /* å›¾ç‰‡æ ·å¼ */
    .image-preview {
        width: 100%;       
        height: auto;      
        display: none;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border: 1px solid #eee;
        display: block;    
    }

    .upload-btn-wrapper {
        position: relative;
    }

    .upload-label {
        background: #fff;
        border: 1px solid #ccc;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        color: #333;
    }

    .upload-label:hover { background: #f0f0f0; }

    /* ä½œç­”åŒºåŸŸ */
    .answer-area {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    textarea.answer-input {
        width: 100%;
        height: 300px;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 18px;
        line-height: 1.6;
        resize: vertical;
        box-sizing: border-box;
        font-family: 'Times New Roman', serif;
    }

    textarea.answer-input:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    }

    .footer-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
    }

    .word-count {
        font-size: 0.9rem;
        color: #666;
    }

    .word-count span {
        font-weight: bold;
        color: var(--primary-color);
    }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.6; }
        100% { opacity: 1; }
    }
</style>
</head>
<body>

<div class="container">
    <!-- 1. å€’è®¡æ—¶æ§åˆ¶åŒº -->
    <div class="header">
        <div class="timer-controls">
            <label>è®¾ç½®æ—¶é—´(åˆ†é’Ÿ):</label>
            <input type="number" id="timeInput" value="10" min="1" max="180">
            <button class="btn-start" onclick="toggleTimer()" id="startBtn">å¼€å§‹è®¡æ—¶</button>
            <button class="btn-reset" onclick="resetTimer()">é‡ç½®</button>
        </div>
        <div class="timer-display" id="timerDisplay">10:00</div>
    </div>

    <!-- 2. é¢˜ç›®åŒºåŸŸ -->
    <div class="section-title">
        é¢˜ç›®æ  (æ”¯æŒæˆªå›¾ Ctrl+V ç²˜è´´ï¼Œæˆ–ç›´æ¥ç²˜è´´é•¿æ–‡æœ¬)
        <div class="upload-btn-wrapper">
            <label for="imgUpload" class="upload-label">ğŸ“‚ é€‰å›¾ç‰‡æ–‡ä»¶</label>
            <input type="file" id="imgUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
        </div>
    </div>
    <div class="question-area" id="questionArea">
        <textarea class="question-input" id="questionTextInput" rows="1" placeholder="åœ¨æ­¤å¤„ç²˜è´´é¢˜ç›®æ–‡æœ¬ï¼Œæˆ–è€… Ctrl+V ç²˜è´´æˆªå›¾..."></textarea>
        <img id="previewImg" class="image-preview" style="display:none;" alt="é¢˜ç›®å›¾ç‰‡">
    </div>

    <!-- 3. ä½œç­”åŒºåŸŸ -->
    <div class="section-title">
        ä½œç­”åŒº
    </div>
    <div class="answer-area">
        <textarea class="answer-input" id="answerInput" placeholder="å¼€å§‹ä½ çš„å†™ä½œç»ƒä¹ ..." oninput="updateWordCount()"></textarea>
        
        <div class="footer-controls">
            <div class="word-count">å½“å‰å­—æ•°: <span id="wordCount">0</span></div>
            <button class="btn-submit" onclick="exportToDoc()">
                ğŸ“¥ æäº¤å¹¶ä¸‹è½½æ–‡æ¡£
            </button>
        </div>
    </div>
</div>

<script>
    // === è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦ ===
    function autoResizeTextarea(element) {
        element.style.height = 'auto'; 
        element.style.height = element.scrollHeight + 'px'; 
    }

    const questionInput = document.getElementById('questionTextInput');
    
    questionInput.addEventListener('input', function() {
        autoResizeTextarea(this);
    });

    questionInput.addEventListener('paste', function() {
        setTimeout(() => autoResizeTextarea(this), 0);
    });
    // ========================

    let timerInterval;
    let totalSeconds = 600; 
    let overtimeSeconds = 0; 
    let isRunning = false;
    let isOvertime = false; 
    let hasStarted = false; 

    function formatTime(sec) {
        const minutes = Math.floor(sec / 60);
        const seconds = sec % 60;
        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function toggleTimer() {
        const startBtn = document.getElementById('startBtn');
        const timeInput = document.getElementById('timeInput');

        if (isRunning) {
            clearInterval(timerInterval);
            startBtn.textContent = "ç»§ç»­è®¡æ—¶";
            startBtn.style.backgroundColor = "#f39c12"; 
            isRunning = false;
            
            if (isOvertime) {
                alert(`ç»ƒä¹ æš‚åœï¼\nä½ å·²è¶…æ—¶ï¼š${formatTime(overtimeSeconds)}`);
            }

        } else {
            if (startBtn.textContent === "å¼€å§‹è®¡æ—¶") {
                totalSeconds = parseInt(timeInput.value) * 60;
                overtimeSeconds = 0;
                isOvertime = false;
                hasStarted = true;
            }

            startBtn.textContent = "æš‚åœè®¡æ—¶";
            startBtn.style.backgroundColor = "#e74c3c"; 
            isRunning = true;

            updateDisplay();

            timerInterval = setInterval(() => {
                if (totalSeconds > 0) {
                    totalSeconds--;
                } else {
                    isOvertime = true;
                    overtimeSeconds++;
                }
                updateDisplay();
            }, 1000);
        }
    }

    function resetTimer() {
        clearInterval(timerInterval);
        isRunning = false;
        isOvertime = false;
        overtimeSeconds = 0;
        hasStarted = false;

        const startBtn = document.getElementById('startBtn');
        startBtn.textContent = "å¼€å§‹è®¡æ—¶";
        startBtn.style.backgroundColor = "";

        const timeInput = document.getElementById('timeInput');
        totalSeconds = parseInt(timeInput.value) * 60;

        const display = document.getElementById('timerDisplay');
        display.classList.remove('timer-warning', 'timer-overtime');
        updateDisplay();
    }

    function updateDisplay() {
        const display = document.getElementById('timerDisplay');
        
        if (!isOvertime) {
            display.textContent = formatTime(totalSeconds);
            display.classList.remove('timer-overtime');
            if (totalSeconds < 60 && totalSeconds > 0) {
                display.classList.add('timer-warning');
            } else {
                display.classList.remove('timer-warning');
            }
        } else {
            display.textContent = "+ " + formatTime(overtimeSeconds);
            display.classList.remove('timer-warning');
            display.classList.add('timer-overtime');
        }
    }

    document.getElementById('questionTextInput').addEventListener('paste', function(e) {
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        
        for (let index in items) {
            const item = items[index];
            if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
                const blob = item.getAsFile();
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.getElementById('previewImg');
                    img.src = event.target.result;
                    img.style.display = 'block'; 
                };
                reader.readAsDataURL(blob);
            }
        }
    });

    function handleImageUpload(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('previewImg');
                img.src = e.target.result;
                img.style.display = 'block';
            }
            reader.readAsDataURL(file);
        }
    }

    function updateWordCount() {
        const text = document.getElementById('answerInput').value;
        const count = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
        document.getElementById('wordCount').textContent = count;
    }

    function exportToDoc() {
        if (isRunning) {
            toggleTimer();
        }

        const topicText = document.getElementById('questionTextInput').value || "ï¼ˆæœªå¡«å†™é¢˜ç›®æ–‡æœ¬ï¼‰";
        const answerText = document.getElementById('answerInput').value || "ï¼ˆæœªå¡«å†™ä½œç­”å†…å®¹ï¼‰";
        const wordCount = document.getElementById('wordCount').textContent;
        const imgElement = document.getElementById('previewImg');
        const hasImage = imgElement.style.display === 'block';

        let timeUsedStr = "æœªå¼€å§‹è®¡æ—¶";
        if (hasStarted) {
            const setTimeMin = parseInt(document.getElementById('timeInput').value);
            const setTimeSec = setTimeMin * 60;
            
            if (isOvertime) {
                const totalUsedSec = setTimeSec + overtimeSeconds;
                timeUsedStr = `${formatTime(totalUsedSec)} (è¶…æ—¶ ${formatTime(overtimeSeconds)})`;
            } else {
                const usedSec = setTimeSec - totalSeconds;
                timeUsedStr = formatTime(usedSec);
            }
        }

        let htmlContent = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head>
                <meta charset="utf-8">
                <title>å†™ä½œç»ƒä¹ å¯¼å‡º</title>
                <style>
                    body { font-family: 'SimSun', 'å®‹ä½“', serif; }
                    h1 { text-align: center; color: #4a90e2; }
                    .section-header { background-color: #f0f0f0; padding: 5px; font-weight: bold; margin-top: 20px; border-left: 5px solid #4a90e2; }
                    .content { font-family: 'Times New Roman', serif; font-size: 12pt; line-height: 1.5; }
                    .meta { color: #666; font-size: 10pt; margin-bottom: 20px; }
                </style>
            </head>
            <body>
                <h1>å†™ä½œç»ƒä¹ æŠ¥å‘Š</h1>
                <div class="meta">
                    <p>æ—¥æœŸï¼š${new Date().toLocaleString()}</p>
                    <p>ç”¨æ—¶ï¼š${timeUsedStr} | å­—æ•°ï¼š${wordCount}</p>
                </div>

                <div class="section-header">é¢˜ç›®</div>
                <p>${topicText.replace(/\n/g, '<br>')}</p>
                ${hasImage ? `<br><img src="${imgElement.src}" width="400" /><br>` : ''}

                <div class="section-header">ä½œç­”å†…å®¹</div>
                <div class="content">
                    ${answerText.replace(/\n/g, '<br>')}
                </div>

                <hr>
                <p style="text-align: center; color: #999; font-size: 9pt;">Generated by å°æ™ºå†™ä½œç»ƒä¹ å®¤</p>
            </body>
            </html>
        `;

        const blob = new Blob(['\ufeff', htmlContent], {
            type: 'application/msword'
        });
        
        const now = new Date();
        const fileName = `å†™ä½œç»ƒä¹ _${now.getFullYear()}${now.getMonth()+1}${now.getDate()}_${now.getHours()}${now.getMinutes()}.doc`;
        
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }

    updateDisplay();
</script>

</body>
</html>
